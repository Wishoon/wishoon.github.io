{"componentChunkName":"component---src-templates-post-jsx","path":"/현재 시간을 검증해야 하는 로직 개선에 대해 고민해보기/","result":{"data":{"site":{"siteMetadata":{"title":"rookie"}},"markdownRemark":{"id":"c20ecd3e-8f83-53ad-89dd-dc937758fc6e","excerpt":"현재 우아한테크코스 기간동안 진행했던 프로젝트인 “꼭꼭” 프로젝트를 개선하는 작업을 개인적으로 해보고 있습니다. 개선사항으로 느꼈던 부분 중 하나가 바로 “현재 시간을 검증해야 하는 로직”이였는데요. 이번 글에서는 해당 부분을 개선하기 위해서 어떤 방법을 고민했었는지를 작성해보는 시간을 가져보려고 합니다. 문제 사항은 무엇인가? 제작하고 있는 어플리케이션…","html":"<p>현재 우아한테크코스 기간동안 진행했던 프로젝트인 “꼭꼭” 프로젝트를 개선하는 작업을 개인적으로 해보고 있습니다. 개선사항으로 느꼈던 부분 중 하나가 바로 “현재 시간을 검증해야 하는 로직”이였는데요. 이번 글에서는 해당 부분을 개선하기 위해서 어떤 방법을 고민했었는지를 작성해보는 시간을 가져보려고 합니다.</p>\n<h2>문제 사항은 무엇인가?</h2>\n<p>제작하고 있는 어플리케이션은 쿠폰을 발급하고, 사용을 신청하고, 사용을 승인하는 상태 변경 흐름을 기반으로 동작하게 됩니다. 이때 발급된 쿠폰에 대하여 사용 신청을 하는 로직을 구성하면서 몇가지 고민 상황을 만나게 됩니다.</p>\n<h2>고민 1. 시간을 검증하는 책임을 어디에 둘 것인가?</h2>\n<h3>생성자에서 검증하기</h3>\n<p>비즈니스 로직을 작성하면서 가장 먼저 만났던 문제는 <strong>“시간을 검증하는 책임을 어디에 맡길 것인가?”</strong> 였습니다. 현재 검증하고자 하는 시간은 <strong>“예약을 할 때 필요한 시간”</strong>입니다. 예약시간은 현재 시간 이전으로는 설정할 수 없다는 비즈니스 로직을 가지기 때문에, 객체 응집도를 위해서 <strong>도메인 내부에서 검증</strong>을 하는 것이 좋을 것이라 생각하였습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Reservation</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Reservation</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">,</span>\n                       <span class=\"token comment\">// ...</span>\n                       <span class=\"token keyword\">final</span> <span class=\"token class-name\">LocalDateTime</span> appointedTime<span class=\"token punctuation\">,</span>\n                       <span class=\"token keyword\">final</span> <span class=\"token class-name\">Condition</span> condition<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">validateReservationAppointedTime</span><span class=\"token punctuation\">(</span>appointedTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>appointedTime <span class=\"token operator\">=</span> appointedTime<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>condition <span class=\"token operator\">=</span> condition<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">validateReservationAppointedTime</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">LocalDateTime</span> appointedTime<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>appointedTime<span class=\"token punctuation\">.</span><span class=\"token function\">isBefore</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">LocalDateTime</span><span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"현재 시간보다 이전에 예약을 할 수 없습니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>하지만 이러한 설계는 한 가지 문제를 가지게 됩니다. 바로 예약 도메인을 반환할 때 문제가 생기는 것인데요. 위의 로직을 보게 되면 생성자에서 이를 검증해주고 있습니다. 예약을 생성하는 로직에서는 이러한 검증은 올바르다고 할 수 있지만, <strong>예약을 조회하는 로직에서 해당 검증은 적절</strong>하다고 할 수 있을까요??</p>\n<p>예약을 한 시간보다 이후에 예약을 조회하는 경우 해당 검증으로 인해 예외가 발생할 수 밖에 없습니다. 이러한 문제상황 때문에 생성자에서 <code class=\"language-text\">Validate</code>를 하는 것은 적절하지 못하다는 판단을 하게 되었습니다.</p>\n<h3>Domain Layer의 정적 팩터리 메서드를 활용해 검증하기</h3>\n<p>그렇다면 예약을 생성하는 로직에만 시간 검증을 포함해주면 발생하고 있는 문제를 해결할 수 있을 것이라 생각하였습니다. 다음과 같이 <strong>예약을 생성하는 정적 팩터리 메서드를 활용</strong>한다면 문제를 해결할 수 있을 것 같습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Reservation</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Reservation</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">,</span>\n                       <span class=\"token comment\">// ...</span>\n                       <span class=\"token keyword\">final</span> <span class=\"token class-name\">LocalDateTime</span> appointedTime<span class=\"token punctuation\">,</span>\n                       <span class=\"token keyword\">final</span> <span class=\"token class-name\">Condition</span> condition<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>appointedTime <span class=\"token operator\">=</span> appointedTime<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>condition <span class=\"token operator\">=</span> condition<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Reservation</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">,</span>\n                                     <span class=\"token comment\">// ...</span>\n                                     <span class=\"token keyword\">final</span> <span class=\"token class-name\">LocalDateTime</span> appointedTime<span class=\"token punctuation\">,</span>\n                                     <span class=\"token keyword\">final</span> <span class=\"token class-name\">Condition</span> condition<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">validateReservationAppointedTime</span><span class=\"token punctuation\">(</span>appointedTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Reservation</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span> appointedTime<span class=\"token punctuation\">,</span> condition<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">validateReservationAppointedTime</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">LocalDateTime</span> appointedTime<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>appointedTime<span class=\"token punctuation\">.</span><span class=\"token function\">isBefore</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">LocalDateTime</span><span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"현재 시간보다 이전에 예약을 할 수 없습니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>하지만 해당 로직을 사용하기에는 몇가지 문제점이 있었는데요. 뒤에서도 설명하겠지만 첫번째로는 <strong><code class=\"language-text\">LocalDateTime</code>을 사용하는 테스트 로직에서 문제가 발생</strong>합니다. 이는 뒤에서 자세하게 설명하겠습니다.</p>\n<p>두번째로는 <strong>객체 생성을 할 수 있는 기능이 두 곳이라는 점</strong>입니다. 생성자로도 예약을 생성할 수 있고, 정적 팩터리 메서드로도 예약을 생성할 수 있기 때문에 협업을 하는 프로젝트에서는 착각의 소지를 줄 수 있는 여지를 남기게 됩니다. 이러한 점 때문에 정적 팩터리 메서드를 사용하는 방법에 대해서도 반려를 하게 되었습니다.</p>\n<h3>Application Layer에서 검증하기</h3>\n<p>마지막으로 고민한 방법이면서 최종 채택한 방법으로 <strong><code class=\"language-text\">Application Layer</code>에서 검증하는 방법</strong>을 선택하였습니다. 사실 어찌보면 가장 단순한 해결책이라고 할 수도 있습니다. 하지만 무분별하게 <code class=\"language-text\">Application Layer</code>에서 검증을 수행하게 되면 도메인 로직이 외부로 드러나게 되고, 응집도가 낮아지는 문제가 발생할 수 있기 때문에 정말 필요할 때만 이를 사용하고 있습니다.</p>\n<p>해당 기능에서 <code class=\"language-text\">Application Layer</code>에서 시간 검증을 수행한 이유는 다음과 같습니다.</p>\n<ul>\n<li>예약을 생성하는 로직에서 현재 시간을 검증하는 로직은 오직 한 곳에서만 이루어진다.</li>\n<li>시간 관련 테스트가 수월해진다. (뒤에서 설명)</li>\n<li>예약을 생성하는 요청에 대한 검증이기 때문에 어떻게 보면 도메인 검증이라고 보기 어려울 수 있다.</li>\n</ul>\n<p>다음과 같은 내용들을 근거로 해서 최종적으로 <code class=\"language-text\">Application Layer</code>에서 시간 검증을 수행해주기로 하엿습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ReservationService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ReservationRepository</span> reservationRepository<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ReservationValidator</span> reservationValidator<span class=\"token punctuation\">;</span>\n  \n    <span class=\"token annotation punctuation\">@Transactional</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Long</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Long</span> memberId<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ReservationCreateRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        reservationValidator<span class=\"token punctuation\">.</span><span class=\"token function\">validateExistsCoupon</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getCouponId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">validateReservationAppointedTime</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getAppointedTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Reservation</span> reservation <span class=\"token operator\">=</span> <span class=\"token function\">createReservation</span><span class=\"token punctuation\">(</span>memberId<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> reservationRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>reservation<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">validateReservationAppointedTime</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">LocalDateTime</span> appointedTime<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>appointedTime<span class=\"token punctuation\">.</span><span class=\"token function\">isBefore</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">LocalDateTime</span><span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span>clock<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"현재 시간보다 이전에 예약을 할 수 없습니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>고민 2. 현재 시간을 검증하는 로직을 어떻게 구성할 것인가?</h2>\n<p>사실 이번 글의 핵심이라고도 할 수 있습니다. 검증을 수행해야 하는 부분이 <strong>“현재 시간”</strong>은 매번 테스트할 때마다 시간이 달라지기 때문입니다. 따라서 <strong>지금 작성한 테스트 코드가 시간이 지나면 실패하는 테스트 코드로 변경</strong>될 수 있습니다. 어떻게 하면 위의 문제를 해결할 수 있을까요??</p>\n<h3>LocalDateTime.now()는 모킹이 가능할까??</h3>\n<p>일차적으로는 <code class=\"language-text\">LocalDateTime.now()</code> 에 대한 값을 모킹하는 것을 고려해볼 수 있습니다. 하지만 Mockito의 코어 라이브러리는 <code class=\"language-text\">mockito-core</code> 에서는 <code class=\"language-text\">LocalDateTime.now()</code> 와 같은 <code class=\"language-text\">static method</code>를 모킹하는 기능을 기본적으로 제공하지 않습니다.</p>\n<p>왜 <code class=\"language-text\">static method</code>에 대해서 모킹하는 기능을 제공하지 않을까요?? 이를 가능하게 하려면 추가적인 라이브러리를 적용해야 하고, private 메서드, final 클래스 등이 테스트가 가능한 상태가 되어버립니다. 즉 <code class=\"language-text\">private method</code>도 테스트할 수 있는 상태가 되어버리기게 됩니다. <code class=\"language-text\">private method</code>에 대한 테스트 불필요성은 검색만 해보면 쉽게 확인할 수 있기 때문에 생략하도록 하겠습니다.</p>\n<h3>Clock을 통한 문제 해결</h3>\n<p><code class=\"language-text\">LocalDateTime.now()</code>의 코드를 확인해보면 밑의 사진과 같은 코드를 확인할 수 있습니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/0d0ccba125cf24d56ead775d7002cf3f/949cf/img.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 31.176470588235293%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5UlEQVQY022QWW7DMAwFfZ1qI6nFTrwk9z/V65Nsp0XRjwFFkBqKmpJF2ENhiwx0KdC5QVplNNYE+XnWdZazl/RzJ0oYeO/hvhymqPFT1DlBW4FUCiuFjcK71tJPHFwDrkEpR0QNFOaEchjKbpQkFgLxF2ziBj0K+6ScjLz8yq3LTqZsAblEZIqMZ6uUzwXWMionF76kS4P4caHLztfcBIQUxrpj5cLGh3ls2eHJv1v3F9btYHzj/TqwbytqWzgsI/R/cu5f+h92ppi4f3DQ6CFmUOXqokNguUKY97OonsLr4l9u6TftCrsHGsC4cAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img' title='img' src='/static/0d0ccba125cf24d56ead775d7002cf3f/ca1dc/img.png' srcset='/static/0d0ccba125cf24d56ead775d7002cf3f/e7570/img.png 170w,\n/static/0d0ccba125cf24d56ead775d7002cf3f/f46e7/img.png 340w,\n/static/0d0ccba125cf24d56ead775d7002cf3f/ca1dc/img.png 680w,\n/static/0d0ccba125cf24d56ead775d7002cf3f/02d09/img.png 1020w,\n/static/0d0ccba125cf24d56ead775d7002cf3f/9d567/img.png 1360w,\n/static/0d0ccba125cf24d56ead775d7002cf3f/949cf/img.png 1740w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>해당 코드를 확인해보면 <code class=\"language-text\">Clock</code>이라는 클래스를 확인할 수 있습니다. <code class=\"language-text\">now(Clock.systemDefaultZone());</code>을 확인해보면 접근 제어자가 <code class=\"language-text\">public</code>으로 되어있는 것을 확인할 수 있습니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/008334fcaae5e77e3e412cb0f9b0dad5/949cf/img_1.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABN0lEQVQoz01RWxKDIBDzOshjeSiCoLad3v9K6YKt9iMkuzDZzDJoUrAzgYI5MRmub32Ba6UlpPzHCKkE48tSYDBeIxSHafMIlbneuvd33+tfz6+290Ox8GVhVLgU4XIGzQsGZTVspDPFTHfCXhu0gS3J2NPIjp60aW2Yie/1ycpgsE7BRwM3KTg28AunSA4ucpKFYL2FUoqhoaTCOLL5KL9oWnz5xDCTRJocagzMHrnsOB5vrMzbuiClhJRX5LXABQdDGqMQEOI2+t/rIHjSMnvUNSPXA2vdEFNGXHI3v8wcJ54nxDgjhAAigjamm/xMe8J2JDY8SkbdH9gfL063sUnt9fF6YzueKNuBUnkAmx/Pd79rbzIPNFpfpoNpk/i7DcNad8K5W18933dJZLu29txt04aT/gw/PZ78PxdTT+cAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 1' title='img 1' src='/static/008334fcaae5e77e3e412cb0f9b0dad5/ca1dc/img_1.png' srcset='/static/008334fcaae5e77e3e412cb0f9b0dad5/e7570/img_1.png 170w,\n/static/008334fcaae5e77e3e412cb0f9b0dad5/f46e7/img_1.png 340w,\n/static/008334fcaae5e77e3e412cb0f9b0dad5/ca1dc/img_1.png 680w,\n/static/008334fcaae5e77e3e412cb0f9b0dad5/02d09/img_1.png 1020w,\n/static/008334fcaae5e77e3e412cb0f9b0dad5/9d567/img_1.png 1360w,\n/static/008334fcaae5e77e3e412cb0f9b0dad5/949cf/img_1.png 1740w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>즉, 매개변수인 <code class=\"language-text\">Clock</code>을 <code class=\"language-text\">Bean</code>으로 등록하여 우리가 원하는 시간으로 설정한다면 <code class=\"language-text\">LocalDateTime.now()</code>을 우리가 원하는 결과로 만들 수 있을 것으로 보입니다.</p>\n<p>그러면 하나씩 적용을 해보도록 하겠습니다. 앞에서 언급한 것처럼 <code class=\"language-text\">Clock</code>을 빈으로 등록해 줍니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/8408ddf92dc226b212a2a1abffa33491/949cf/img_2.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 41.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA8ElEQVQoz5VSSXLEIAz0c0AyAoyNN2Y75f8v6ghqnEqlxlOZQ9OIpWlJdPc7oxSrEOQ1YZgEEhzCIIgpgYlBRGDmf6F7XBi3nXBVVF7nHuI9RATOCXrnPhNcAmMSRuwZdR68OhsSYoyKoYm/Ejx7pDOW4ANhzARigjEG1lbYBiL78uKpoLXqbGR83QgpOq3hjKDunKbaHIp/ipsfPsQq/xXuSAdRZE17Tz3KMmHbL5iXrfFWrlj3gjyvmPLS1mMI5w5ZN5y64F476zR9Nq0h1WVFrWcap8Y1HtIIedOorh46AquH7PObHDVsMOZX/D7lb/Sz9MJVVAchAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 2' title='img 2' src='/static/8408ddf92dc226b212a2a1abffa33491/ca1dc/img_2.png' srcset='/static/8408ddf92dc226b212a2a1abffa33491/e7570/img_2.png 170w,\n/static/8408ddf92dc226b212a2a1abffa33491/f46e7/img_2.png 340w,\n/static/8408ddf92dc226b212a2a1abffa33491/ca1dc/img_2.png 680w,\n/static/8408ddf92dc226b212a2a1abffa33491/02d09/img_2.png 1020w,\n/static/8408ddf92dc226b212a2a1abffa33491/9d567/img_2.png 1360w,\n/static/8408ddf92dc226b212a2a1abffa33491/949cf/img_2.png 1740w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>그리고 <code class=\"language-text\">Application Layer</code>에서 검증을 위해 사용되고 있는 <code class=\"language-text\">LocalDateTime.now()</code>에 매개변수 <code class=\"language-text\">Clock</code>을 넣어줍니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/b1bce1b362dbf002aa948c574226c854/949cf/img_3.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 53.529411764705884%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlElEQVQoz3VTW3KkMAzkOIMtvx9gDEySrU3V3v9AvZKT3RpqJh9dkgVqrFYzHV1jqQolE2IkEBGUUk/QWl/yRzzWpug0vCW4kOBiRkgZxpjxkPTXByS+InpJ2J3Cn3TDZ7H4PN/w+zix9R01r1hSQysd0YUnwsfzhbBZhY9ww53HPUrFnhJCCHA+wBoPz9DcMM83qHnm5vkiwROh9xq1WpTq4UjBWDfGFhmCt/AxsrYJKRcEzkOI0PSzBBNpWUpD3070taP3A/v5jv24o++Svw30/YRz7rKcf7cd5OqrPskLOVfUsiKXBXVtvPGMZVlRGWvbRly47lkG5/y4pUTP0lhrYZ3lyYijwaR4g87IpgO8E/0KN8YxdpAxU0HkDxBvnowdMEwiThAyQ99OMMQ1YtswWdE3ZD2jSs46CkZuFLKcuTmR/o+gf/Ipa7jQjBYNzpbxfqz4OLeBX/cN975gqxmtNZYkszSJZckoPKIT/V7ZJn9fOYi5WXTP5vZscoHhM1ke1cpI3MC3Uwwhc2KlQXL9e/4C50pVZDVzEgYAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 3' title='img 3' src='/static/b1bce1b362dbf002aa948c574226c854/ca1dc/img_3.png' srcset='/static/b1bce1b362dbf002aa948c574226c854/e7570/img_3.png 170w,\n/static/b1bce1b362dbf002aa948c574226c854/f46e7/img_3.png 340w,\n/static/b1bce1b362dbf002aa948c574226c854/ca1dc/img_3.png 680w,\n/static/b1bce1b362dbf002aa948c574226c854/02d09/img_3.png 1020w,\n/static/b1bce1b362dbf002aa948c574226c854/9d567/img_3.png 1360w,\n/static/b1bce1b362dbf002aa948c574226c854/949cf/img_3.png 1740w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>그리고 해당 로직을 검증할 테스트 코드에서 <code class=\"language-text\">clock.instant()</code>를 모킹하여 우리가 원하는 시간으로 변경하는 작업을 수행해줍니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/c16f9b424e05b8a35059bfba91624438/949cf/img_4.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 36.47058823529412%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyklEQVQoz4WQWw7CIBBFux2B4TU8CjXuf1fXgdbEVqMfJ4HAPXBn6UUhRgutNdTtBqXUB/Psbf3af1svNRF6ywiR4X0AEcGQmZCgzTnwVzgEzoVdGA6hSIbIkGDMJfz3hwa9BmT2sORgNMFad2BPdb+N4nq+WOew9g25VFRuKHHF2jb0+wNtu8t8WRp4OO/38KX6lSnMdUXKBTlVMOe5L7XNR5gT4kDEVsSvn4fgZUQHfuDkbhShXOCUJZCmbARnWEL7PM3vyupc+QnWutaaCbqDPAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 4' title='img 4' src='/static/c16f9b424e05b8a35059bfba91624438/ca1dc/img_4.png' srcset='/static/c16f9b424e05b8a35059bfba91624438/e7570/img_4.png 170w,\n/static/c16f9b424e05b8a35059bfba91624438/f46e7/img_4.png 340w,\n/static/c16f9b424e05b8a35059bfba91624438/ca1dc/img_4.png 680w,\n/static/c16f9b424e05b8a35059bfba91624438/02d09/img_4.png 1020w,\n/static/c16f9b424e05b8a35059bfba91624438/9d567/img_4.png 1360w,\n/static/c16f9b424e05b8a35059bfba91624438/949cf/img_4.png 1740w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>이러한 작업을 통해 성공적으로 현재 시간에 대한 테스트를 수행할 수 있습니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/d115c521859a7694c161ec346f4c41e2/949cf/img_5.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 34.11764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABKElEQVQoz42Q626DMAyFeRxoy3VQLgkkpIW2UOg6aZq2SX3/tziz01FNkybtxyfHsXx8bOfzdsPb+wfGccI0X3CeZpyGEV3X2/zyfMWO3t1wwuE0Uu1sc212xB5m36NWLWSjCQUnlAbyeEY3v6IdrmjHF4huQlgZxHKPvB2QVC3KqoKsa1QU8zxHWZYoigI5URT3d5qmcNy0gc8NZkCmDkibHkFp4GUKXItkhydhkGUZ6m/B9XqN1Wpl428crVsoslyT3UYxmnIN/rc1QkgJ13Wx3W6t8GazsbCo53mPyDj33ekG6gfNchNt71OK+uGK12KXkoYkSYIgCCxRFCEMQzjc8BeLYEWCLBbHsRXj5sUtD2D4rpz/W5Ad8posJISw4r7vPxwy7PAL7J/rDfq97W8AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 5' title='img 5' src='/static/d115c521859a7694c161ec346f4c41e2/ca1dc/img_5.png' srcset='/static/d115c521859a7694c161ec346f4c41e2/e7570/img_5.png 170w,\n/static/d115c521859a7694c161ec346f4c41e2/f46e7/img_5.png 340w,\n/static/d115c521859a7694c161ec346f4c41e2/ca1dc/img_5.png 680w,\n/static/d115c521859a7694c161ec346f4c41e2/02d09/img_5.png 1020w,\n/static/d115c521859a7694c161ec346f4c41e2/9d567/img_5.png 1360w,\n/static/d115c521859a7694c161ec346f4c41e2/949cf/img_5.png 1740w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<h2>고민 3. 해당 검증을 하는 테스트 환경을 어떻게 구성할 것인가?</h2>\n<h3>Mocking으로 인한 테스크 코드 실행시간의 문제</h3>\n<p>일반적으로는 위의 방법을 통해 문제를 해결할 수 있지만 한 가지 고려해야 할 점이 있습니다. 바로 <code class=\"language-text\">Mocking</code>을 한다는 점입니다. Mocking을 하게 되면 기본의 빈과는 다르기 때문에 <code class=\"language-text\">Spring Context</code>가 새로 띄어지게 됩니다. 이는 곧 <strong>테스트 코드 실행 시간의 증가를 의미</strong>합니다.</p>\n<p>실제로 실행 로그를 통해 확인해보면 새로운 <code class=\"language-text\">Spring Context</code>가 띄워지는 것을 확인할 수 있습니다.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/b73190009eb1f95acd946767f62160ce/949cf/img_6.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 38.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzklEQVQoz42SRw4EMQgE/Z3JOef/P4pVIbU1u6c9lFBjDBgc1nW1bducfd/tPE/DB+jjOBz8aOJ0pnuwLIsTCFTwdV32PE8MRt/3HS2J8ROPT/pdMIzjaGKaJq8yDEPU8zxH0ND3vb3vvQlFUZgoy9JtkiR/k6bplw50Q8Wu65y2bS3LMg+UFehf3++ZJyRJVVXWNI3Vde0BeZ5H6Bqri2+fkD8wG20Oy7M5ZJbMi4FrAbyAOWnz763TGARtSZYOSagl6Bdo0xTSRpUU9NU+it0CZMULIx8AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='같은 `@IntegrationTest`를 사용하는 `CouponQueryServiceTest`를 실행했을 때 발생하는 로그' title='같은 `@IntegrationTest`를 사용하는 `CouponQueryServiceTest`를 실행했을 때 발생하는 로그' src='/static/b73190009eb1f95acd946767f62160ce/ca1dc/img_6.png' srcset='/static/b73190009eb1f95acd946767f62160ce/e7570/img_6.png 170w,\n/static/b73190009eb1f95acd946767f62160ce/f46e7/img_6.png 340w,\n/static/b73190009eb1f95acd946767f62160ce/ca1dc/img_6.png 680w,\n/static/b73190009eb1f95acd946767f62160ce/02d09/img_6.png 1020w,\n/static/b73190009eb1f95acd946767f62160ce/9d567/img_6.png 1360w,\n/static/b73190009eb1f95acd946767f62160ce/949cf/img_6.png 1740w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>같은 `@IntegrationTest`를 사용하는 `CouponQueryServiceTest`를 실행했을 때 발생하는 로그</figcaption>\n  </figure></p>\n<br>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/30daac0f30badb2526aa2d8bed3a4b73/949cf/img_7.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 36.47058823529412%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAwElEQVQoz52RW66DMAxEsx4IAQLi/dr/ptx7LM1VVKn96MdobOIxtiec52nbttlxHLbvu3OM0bqus2VZ/O2+b7uuy57nsXmevY4cLfXE0od1Xb1ITJO6rq1tW5umyXOEFMOqJQfE/JQYDjG1PpHQNI1zVVU/IfQ52ziONgyDg5jpPgmY/mvD3Pe+Rv5rTCOawgiZVkgp/Tcrv5U1bBbYW3fhXu83BDKLN8xCA9AI2jKUhxXLZZkkN3FZBsjV0hzwAplP39oGHQXYAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='같은 `@IntegrationTest`를 사용하는 `ReservationTest`를 실행했을 때 발생하는 로그' title='같은 `@IntegrationTest`를 사용하는 `ReservationTest`를 실행했을 때 발생하는 로그' src='/static/30daac0f30badb2526aa2d8bed3a4b73/ca1dc/img_7.png' srcset='/static/30daac0f30badb2526aa2d8bed3a4b73/e7570/img_7.png 170w,\n/static/30daac0f30badb2526aa2d8bed3a4b73/f46e7/img_7.png 340w,\n/static/30daac0f30badb2526aa2d8bed3a4b73/ca1dc/img_7.png 680w,\n/static/30daac0f30badb2526aa2d8bed3a4b73/02d09/img_7.png 1020w,\n/static/30daac0f30badb2526aa2d8bed3a4b73/9d567/img_7.png 1360w,\n/static/30daac0f30badb2526aa2d8bed3a4b73/949cf/img_7.png 1740w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>같은 `@IntegrationTest`를 사용하는 `ReservationTest`를 실행했을 때 발생하는 로그</figcaption>\n  </figure></p>\n<h3>프로젝트 테스트 구성 환경의 문제</h3>\n<p>현재 통합 테스트의 환경을 설정하는 애노테이션인 <code class=\"language-text\">@IntegrationTest</code>는 <code class=\"language-text\">DEFINED_PORT</code>를 사용하고 있습니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/3cc2833d35e9834ec5c02c5df486ac91/949cf/img_8.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 31.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/ElEQVQY022P4W7DIAyE+zgLJAUcCAEMJN37P9PNpN1UqftxOsuWP93djq7BRaFVjZK/UNhiSztCDKDVwzoHYyxWH+BoFfeXO7OCrL/cGgelFKZpwu3oA6bQm0KtHq0zan+IDuRSUVIDp449lQvkwwYSJwGtAiQ7gPQGPATEAzjhPB1qI5RyB/OGzKf4ida+BZix7elKGl9zzFmaRNGOSAt2pwQoVTtrPI4ZLRN6ZYEktCODWxZnpJ3AfpE0RpJozPMMrfWH1Ei4GYVgZwRyGPNmNchpxCh7LwoKK2ksy3LVuh7FP6WflZe7keG5nMby7/im19Mv7L90QwP4A9TOvep3xskDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 8' title='img 8' src='/static/3cc2833d35e9834ec5c02c5df486ac91/ca1dc/img_8.png' srcset='/static/3cc2833d35e9834ec5c02c5df486ac91/e7570/img_8.png 170w,\n/static/3cc2833d35e9834ec5c02c5df486ac91/f46e7/img_8.png 340w,\n/static/3cc2833d35e9834ec5c02c5df486ac91/ca1dc/img_8.png 680w,\n/static/3cc2833d35e9834ec5c02c5df486ac91/02d09/img_8.png 1020w,\n/static/3cc2833d35e9834ec5c02c5df486ac91/9d567/img_8.png 1360w,\n/static/3cc2833d35e9834ec5c02c5df486ac91/949cf/img_8.png 1740w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>이 때문에 같은 환경 내에서 한번 더 <code class=\"language-text\">Spring Context</code>가 띄워질 경우 포트 충돌이 발생하게 됩니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/c430055c48849be8d51ece184c77a4d4/949cf/img_9.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 27.058823529411764%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAv0lEQVQY03WPWQ6CMBgGuQ77mhRJtFILKIGKLPH+J/nsX1NCTHyYdEunU6fiEo/nCt6NyKoa6YmDsRJl+SXPc7iuC8/zdnzf38dfHFFLvOYNba9wFg0uGsaYESVJgjiOEYYhoigy41F2fMTi3DuJbV2gphmjmiBujZGRwEJSSxAEf+tMYSsE1mXFvL3RDwpXIVEUxS6wlce1JU3T/dyuHclrzLpuWjYMulC2nS4sNJkRE1RM36WLNCfsPkmo2go/kkmh4Lk5vzsAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 9' title='img 9' src='/static/c430055c48849be8d51ece184c77a4d4/ca1dc/img_9.png' srcset='/static/c430055c48849be8d51ece184c77a4d4/e7570/img_9.png 170w,\n/static/c430055c48849be8d51ece184c77a4d4/f46e7/img_9.png 340w,\n/static/c430055c48849be8d51ece184c77a4d4/ca1dc/img_9.png 680w,\n/static/c430055c48849be8d51ece184c77a4d4/02d09/img_9.png 1020w,\n/static/c430055c48849be8d51ece184c77a4d4/9d567/img_9.png 1360w,\n/static/c430055c48849be8d51ece184c77a4d4/949cf/img_9.png 1740w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>이러한 문제를 해결하기 위해 저는 테스트 환경에서 하나의 <code class=\"language-text\">LocalDateTime.now</code>를 가지도록 해주기 위해서 <code class=\"language-text\">Clock</code>을 빈으로 등록하는 시점에 시간을 설정하는 방법을 선택하였습니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/1dfb0b1d39f63c0a64b52170017f78ef/949cf/img_10.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 29.411764705882355%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAx0lEQVQY05WRW5aEIAxEWY4JBAKC0PPc/6pqAnbr35yZj3sqSkylxL1/MB4PQe0KLQnMHkSbKcN7v/RV/wX3NTzeGuNzBLSjobZu2qGa/zXoGpjEo2R7mB+HABFZrO2Irg1/5+5zMXp8D0avGXttyKWg7BUpJUiMJ2YQzCyIEfypqz4XiK/eIHDzpdphzwG1Vot8WOSxYs96muxmoJqQckRUsX8dkSYakXPB0ce5jBa46cAWbyO2y6An2xO6WJGIb71qunst+g+MeLcxdloojAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 10' title='img 10' src='/static/1dfb0b1d39f63c0a64b52170017f78ef/ca1dc/img_10.png' srcset='/static/1dfb0b1d39f63c0a64b52170017f78ef/e7570/img_10.png 170w,\n/static/1dfb0b1d39f63c0a64b52170017f78ef/f46e7/img_10.png 340w,\n/static/1dfb0b1d39f63c0a64b52170017f78ef/ca1dc/img_10.png 680w,\n/static/1dfb0b1d39f63c0a64b52170017f78ef/02d09/img_10.png 1020w,\n/static/1dfb0b1d39f63c0a64b52170017f78ef/9d567/img_10.png 1360w,\n/static/1dfb0b1d39f63c0a64b52170017f78ef/949cf/img_10.png 1740w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>이를 통해 <code class=\"language-text\">Clock</code>을 모킹할 때 마다 <code class=\"language-text\">Spring Context</code>가 새로 띄워지는 문제를 제거하여 테스트 코드 실행 시간을 단축할 수 있었고, 전체 테스트를 구동했을 때 포트 충돌이 발생하는 문제를 해결할 수 있었습니다.</p>\n<p>하지만 해당 방법이 완벽한 것은 아닙니다. 모킹된 <code class=\"language-text\">LocalDateTime</code>이 전역적으로 모든 테스트에 설정된다는 점인데요. 이 때문에 협업 시에 문제가 발생할 수 있습니다. 이러한 부분은 <code class=\"language-text\">Trade-Off</code> 라고 보고 있는데, 문서화를 통해 같이 작업하는 사람들에게 미리 공지를 하는 방법으로 해결을 할 수 있을 것이라 생각합니다.</p>\n<h2>참고</h2>\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/68340718/mockito-mock-static-function-does-not-work-if-the-function-is-called-in-a-thread\">https://stackoverflow.com/questions/68340718/mockito-mock-static-function-does-not-work-if-the-function-is-called-in-a-thread</a></li>\n<li><a href=\"https://docs.oracle.com/javase/8/docs/api/java/time/LocalDate.html#now-java.time.Clock-\">https://docs.oracle.com/javase/8/docs/api/java/time/LocalDate.html#now-java.time.Clock-</a></li>\n</ul>","frontmatter":{"title":"현재 시간을 검증해야 하는 로직 개선에 대해 고민해보기","date":"December 10, 2022","update":"December 11, 2022","tags":["Mocking"],"series":null},"fields":{"slug":"/현재 시간을 검증해야 하는 로직 개선에 대해 고민해보기/","readingTime":{"minutes":13.325}}},"seriesList":{"edges":[{"node":{"id":"863212f2-1cb1-5101-804a-5416ffb5b9d3","fields":{"slug":"/Nginx와-Gzip을-활용한-프론트-최적화/"},"frontmatter":{"title":"Nginx와 Gzip을 활용한 프론트 최적화"}}},{"node":{"id":"4c21b76a-ad6b-5e0b-b0e7-a0c0e94b12a9","fields":{"slug":"/Replication과-SpringBoot/"},"frontmatter":{"title":"Replication과 Spring Boot"}}},{"node":{"id":"aae5e42a-02b5-56c8-8475-67f77087a495","fields":{"slug":"/JPA를-사용함으로서-겪었던-문제들/"},"frontmatter":{"title":"JPA를 사용함으로서 겪었던 문제들"}}},{"node":{"id":"948cec5b-7366-505a-992f-1dd680a012ee","fields":{"slug":"/테스트에서의 @Transactional/"},"frontmatter":{"title":"테스트에서의 @Transactional"}}},{"node":{"id":"c4eb0572-f278-5d08-9052-32b5b549b9bb","fields":{"slug":"/DAO와-Repository/"},"frontmatter":{"title":"DAO와 Repository"}}},{"node":{"id":"9adaf203-e9ac-55e1-a772-b716b41c886a","fields":{"slug":"/캐시 설계 전략에 대해서 고민해보기/"},"frontmatter":{"title":"캐시 설계 전략에 대해서 고민해보기"}}},{"node":{"id":"402909e7-5260-5a3b-9183-5ac1017382fe","fields":{"slug":"/로컬 캐시와 글로벌 캐시에 대해서 고민해보기/"},"frontmatter":{"title":"로컬 캐시와 글로벌 캐시에 대해서 고민해보기"}}},{"node":{"id":"c20ecd3e-8f83-53ad-89dd-dc937758fc6e","fields":{"slug":"/현재 시간을 검증해야 하는 로직 개선에 대해 고민해보기/"},"frontmatter":{"title":"현재 시간을 검증해야 하는 로직 개선에 대해 고민해보기"}}},{"node":{"id":"5d3cba24-3007-5309-a0f7-2430e555a818","fields":{"slug":"/JpaTransactionManager는 JDBC도 처리해준다/"},"frontmatter":{"title":"JpaTransactionManager는 JDBC도 처리해준다"}}},{"node":{"id":"d99299ea-4097-5011-8747-1a2ed6f40e8d","fields":{"slug":"/물리적 관점에서 인덱스 살펴보기/"},"frontmatter":{"title":"물리적 관점에서 인덱스 살펴보기"}}}]},"previous":{"fields":{"slug":"/로컬 캐시와 글로벌 캐시에 대해서 고민해보기/"},"frontmatter":{"title":"로컬 캐시와 글로벌 캐시에 대해서 고민해보기"}},"next":{"fields":{"slug":"/JpaTransactionManager는 JDBC도 처리해준다/"},"frontmatter":{"title":"JpaTransactionManager는 JDBC도 처리해준다"}}},"pageContext":{"id":"c20ecd3e-8f83-53ad-89dd-dc937758fc6e","series":null,"previousPostId":"402909e7-5260-5a3b-9183-5ac1017382fe","nextPostId":"5d3cba24-3007-5309-a0f7-2430e555a818"}},"staticQueryHashes":[]}