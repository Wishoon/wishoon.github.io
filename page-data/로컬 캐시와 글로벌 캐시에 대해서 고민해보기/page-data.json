{"componentChunkName":"component---src-templates-post-jsx","path":"/로컬 캐시와 글로벌 캐시에 대해서 고민해보기/","result":{"data":{"site":{"siteMetadata":{"title":"rookie"}},"markdownRemark":{"id":"402909e7-5260-5a3b-9183-5ac1017382fe","excerpt":"최근 관심가지고 학습하고 있는 부분은 “캐시”입니다. 이러한 캐시를 적용하는 방법은 크게 로컬 캐시와 글로벌 캐시로 구분하여 적용을 할 수 있습니다. 각각의 종류들을 수행하고자 하는 기능에 맞게 선택하여 사용할 수 있는데요. 이번 글에서는 두 종류에 대해서 알아보고 적용시 어떤 부분들을 고민해야 하는지, 어떻게 적용해야 하는지 살펴보려고 합니다. 로컬 캐…","html":"<p>최근 관심가지고 학습하고 있는 부분은 “<strong>캐시</strong>”입니다. 이러한 캐시를 적용하는 방법은 크게 로컬 캐시와 글로벌 캐시로 구분하여 적용을 할 수 있습니다. 각각의 종류들을 수행하고자 하는 기능에 맞게 선택하여 사용할 수 있는데요. 이번 글에서는 두 종류에 대해서 알아보고 적용시 어떤 부분들을 고민해야 하는지, 어떻게 적용해야 하는지 살펴보려고 합니다.</p>\n<h2>로컬 캐시 vs 글로벌 캐시</h2>\n<h3>로컬 캐시</h3>\n<p>로컬 캐시는 해당 인스턴스에만 사용되는 캐시입니다. 말 그대로 하나의 로컬 환경에서만 영향을 주기 때문에 네트워크를 탈 필요가 없어 매우 빠른 속도를 보장합니다.</p>\n<p>하지만 분산 시스템에서 로컬 캐시를 사용하면 데이터 정합성이 깨지게 됩니다. 예를 들어, 클라이언트가 같은 리소스에 대한 요청을 여러 번 보내는 상황에서 A 서버에서는 ㄱ 데이터를 반환하지만, B 서버에서는 해당 리스소에 업데이트가 이루어진 ㄴ 데이터를 반환하여 서로 다른 상태를 가질 수도 있습니다.</p>\n<h3>글로벌 캐시</h3>\n<p>글로벌 캐시는 여러 서버에서 하나의 캐시 서버에 접근하여 사용되는 캐시입니다. 각각의 서버는 조회 요청이 들어오면 데이터베이스 앞 단에 있는 캐시 서버로 요청을 보내 작업을 수행하게 됩니다. 즉, 모든 요청이 하나의 캐시 서버로 들어오기 때문에 데이터 정합성을 걱정할 필요가 없습니다.</p>\n<p>하지만 모든 요청이 하나의 캐시 서버로 오기 때문에 부하가 발생할 수 있으며, 네트워크를 한번 더 타기 때문에 상대적으로 속도가 느리다고 할 수 있습니다.</p>\n<h3>어떤 상황에서 무엇을 사용해야 하는가?</h3>\n<p>이 부분에 대해서 많은 고민을 해왔지만 <strong>딱 맞는 정답은 없는 것 같습니다</strong>. 각각의 주어진 요구사항에 따라서 속도가 중요한지, 정합성이 중요한지를 판단하여 적절한 캐시를 적용하는 것이 맞다고 생각합니다.</p>\n<p>또한 앞선 글에서도 언급했듯이 캐시를 아예 사용하지 않는 것도 고려해볼 수 있습니다. 매번 반환하는 데이터가 달라진다면 오히려 캐시에 저장하거나 확인하는 작업으로 인해 성능이 저하될수도 있기 때문입니다.</p>\n<h2>로컬 캐시의 문제점을 극복할 수는 없을까?</h2>\n<p>앞서서 말했듯이 분산 환경에서의 로컬 캐시의 문제점을 해결하기 위해서 글로벌 캐시를 사용한다고 하였습니다. 하지만 글로벌 캐시를 사용하게 되면 <strong>네트워크 I/O 비용이 추가적으로 발생</strong>하며, <strong>중앙 집중적으로 사용하기 때문에 SPOF 문제가 발생하면 서비스 기능 전체가 멈춰버리는 문제가 발생</strong>할 수 있습니다. (물론 해당 문제를 클러스터링을 통해 해결할 수 있다고 합니다.)</p>\n<p>다시 원점으로 돌아가서 로컬 캐시와 글로벌 캐시를 비교한다면 <strong>로컬 캐시는 속도, 비용, SPOF 측면에서 유리하며 글로벌 캐시는 정합성 측면에서 유리</strong>하다고 할 수 있습니다. 그렇다면 <strong>로컬 캐시의 정합성만 조금 손을 보면</strong> 글로벌 캐시의 장점을 어느정도 가져갈 수 있을 것 같다고 생각했습니다.</p>\n<h3>*<strong>*Redis Pub/Sub을 이용한 로컬 캐시 동기화**</strong></h3>\n<p>결국 로컬 캐시를 동기화 시키기 위해서는 어떠한 <strong>“이벤트”</strong>가 있어야 동기화가 이루어질 것입니다. 이러한 <strong>“이벤트”</strong>를 제공하기 위한 기술로 <strong>“레디스”</strong>를 고민해 볼 수 있습니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/47e99917591c15a9ff8db0edaf546317/f97d7/img.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 30%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABH0lEQVQY022RXUvDMBSG99+99MYrf47KBjJQhsrm1iJq7db1C9uuXbt+JI850YKIB96UnKRvnjeZaK0RSSmlGEv/6G+Nfa0VwzBQFAV5nls1TcNEhjRN8X3fLh6PR3qzkSIH7w2SkPjsnPTiEuI9+v0V8oymbTmdThwOB6Iosh4yn7Rmoa5rqqqy387MO4PQLx+pp1cUrkM8nfE5n1O+uNSzG9TTA405VJtEZVlaU5El7LrONkVCN/Q9rdLUi3vy6TWB47B3N4TGOPM/KG9ntIs7KkvYkGUZu92OMAwtkI0szSAIvk0NaSeR4wjWK3DX4HxLbVbo5yVEIa05WO5cko1ANnIvRBLTkEpjfBj9j34/jPwnMEmS4Hke2+3Wmn8B+crJ6lrHoEMAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img' title='img' src='/static/47e99917591c15a9ff8db0edaf546317/ca1dc/img.png' srcset='/static/47e99917591c15a9ff8db0edaf546317/e7570/img.png 170w,\n/static/47e99917591c15a9ff8db0edaf546317/f46e7/img.png 340w,\n/static/47e99917591c15a9ff8db0edaf546317/ca1dc/img.png 680w,\n/static/47e99917591c15a9ff8db0edaf546317/02d09/img.png 1020w,\n/static/47e99917591c15a9ff8db0edaf546317/9d567/img.png 1360w,\n/static/47e99917591c15a9ff8db0edaf546317/f97d7/img.png 2000w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>레디스는 <code class=\"language-text\">Pub/Sub</code> 라는 기능을 제공합니다. 이는 특정한 채널을 구독하는 <code class=\"language-text\">Subscriber</code> 들에게 메시지를 <code class=\"language-text\">BroadCast</code> 하는 방법이라고 할 수 있습니다. 이러한 방법을 이용해 <strong>어떠한 애플리케이션 서버에서 캐시가 갱신되었을 때, 다른 모든 애플리케이션 서버에 메시지를 <code class=\"language-text\">BroadCast</code></strong> 하는 방식으로 <strong>데이터 동기화</strong>를 할 수 있습니다.</p>\n<p>이러한 개념을 바탕으로 실제 분산 환경에 적용한다고 하면 밑의 그림과 같다고 할 수 있습니다. 사용하고 있는 모든 애플리케이션 서버가 <code class=\"language-text\">Publisher</code>이면서 <code class=\"language-text\">Consumer</code>가 되며, 모든 애플리케이션 서버에 메시지를 <code class=\"language-text\">BroadCast</code> 하는 구조로 동작을 하게 됩니다.</p>\n<p>여기서 <code class=\"language-text\">BroadCast</code>를 할 수 있는 방법은 2가지 입니다. 하나는 <strong>키와 데이터를 모두 보내는 방식</strong>이고, 또 다른 방식은 <strong>변경된 키만을 보내는 방식</strong>입니다. 이번에 선택한 방법은 <strong>키만 브로드캐스트 하는 방식</strong> 입니다. 만약 데이터까지 같이 전송하게 된다면 실제 필요없는 애플리케이션의 로컬 캐시도 데이터가 변경되기 때문에 리스소가 낭비될 수 있기 때문입니다. 이 때문에 <strong>갱신이 된 키만을 브로드캐스트 하여 각 어플리케이션의 로컬 캐시에 알려준 후, 갱신된 요청이 들어오면 직접 데이터베이스에 변경된 값을 요청</strong>하는 형식으로 트래픽을 절약하여 동기화를 구현할 수 있습니다.</p>\n<blockquote>\n<p><code class=\"language-text\">Kafka</code>를 사용해보는 건 어떨까??</p>\n</blockquote>\n<p>처음에는 Kafka도 메시지 큐 방식이라 비슷하게 사용이 가능할 것이라 생각했는데, 작동하는 방식은 조금 다릅니다. Kafka는 구조는 동일하지만 메시지를 저장하고 있으며, 동일 <code class=\"language-text\">Consumer</code> 그룹에 여러 <code class=\"language-text\">Consumer</code>가 동일한 토픽을 구독하게 되면 한 <code class=\"language-text\">Consumer</code> 에게만 메시지가 전달되기 때문에 위에서 구상한 방법대로 사용을 할 수 없습니다.</p>\n<h2>로컬 캐시 종류 선택하기</h2>\n<p>로컬 캐시로는 보통 <code class=\"language-text\">Caffeine Cache</code>와 <code class=\"language-text\">Ehache</code>를 많이 사용합니다. 각각의 차이점을 한번 비교해보면서 어떤 라이브러리를 선택해야 할지 고민해보겠습니다.</p>\n<h3>Caffeine Cache</h3>\n<p>Caffeine Cache는 공식문서를 확인해보면 <strong>“고성능의 최적의 캐싱 라이브러리”</strong>라는 문구로 소개를 하고 있습니다. 문구를 통해서도 알 수 있듯이 다양한 캐시들과의 성능 차이 또한 제시하고 있습니다. 이 때문에 많은 서비스에서는 캐시를 사용할 때 Caffeine Cache를 사용하는 것으로 알고 있습니다.</p>\n<p>Caffeine Cache는 <code class=\"language-text\">evict</code> 로직이 자동으로 동작하게끔 구성이 되며, <code class=\"language-text\">eviction</code> 정책으로 <code class=\"language-text\">Window TinyLfu</code> 를 사용하여 구성하고 있습니다. 해당 알고리즘을 통해 다른 캐시 라이브러리에 비해서 최적의 적중률을 보여준다고 합니다. 관련한 글은 다음 글에서 확인할 수 있습니다.</p>\n<ul>\n<li>[Caffeine Cache Baeldung] → <a href=\"https://www.baeldung.com/java-caching-caffeine\">https://www.baeldung.com/java-caching-caffeine</a></li>\n<li>[Caffeine Cache의 Window TinyLfu] → <a href=\"https://www.fatalerrors.org/a/caffeine-cache-details.html\">https://www.fatalerrors.org/a/caffeine-cache-details.html</a></li>\n</ul>\n<h3>EhCache</h3>\n<p>EhCache는 Java 진영에서 유명한 Local Cache 라이브러의 종류 중 하나입니다. EhCache는 Caffeien Cache 보다 더 많은 기능을 제공하며 대표적으로 <strong>Distributed Caching와 Cache Listener, Off Heap에 캐싱된 데이터를 저장하는 기능을 제공</strong>합니다.</p>\n<p>EhCache의 많은 기능 중 관심이 갔던 부분은 <code class=\"language-text\">Off Heap</code> 입니다. <strong>Heap 메모리 공간 이외에 데이터를 저장할 수 있는 기능을 제공</strong>하는 것인데, 해당 기능을 사용하면 GC의 영향을 받지 않는 데이터를 보관할 수 있도록 설계가 가능할 것 같습니다. (Off Heap에 데이터를 저장하거나 반환하게 되면 추가적인 직렬화 비용이 발생합니다)</p>\n<p>EhCache에 대해서 더 자세한 내용은 공식문서를 통해 확인할 수 있습니다.</p>\n<ul>\n<li>[EhCache Docs] → <a href=\"https://www.ehcache.org/documentation/3.4/tiering.html\">https://www.ehcache.org/documentation/3.4/tiering.html</a></li>\n</ul>\n<h3>최종적으로는..?</h3>\n<p>최종적으로는 Caffeine Cache를 선택하기로 했습니다. 벤치마크 성능 측정 결과를 보면 모든 측면에서 Caffeine Cache가 압도적인 성능을 보여주는 것을 확인할 수 있습니다. 현재로서는 단순히 로컬 캐시에 데이터를 저장하고 반환하는 기능만 사용할 예정이기 때문에 Caffeine Cache가 적절하다고 판단했으며, 만약 부가적으로 캐시에 다른 작업을 처리해줘야 할 경우에는 EhCache를 고려해보면 될 것 같습니다.</p>\n<h2>*<strong>*Redis Pub/Sub을 이용한 로컬 캐시 동기화 적용하기**</strong></h2>\n<h3>요구사항</h3>\n<ul>\n<li>쿠폰 시스템에서 쿠폰의 정보들은 캐시에 보관되며, 쿠폰이 업데이트 될 때마다 캐시를 무효화하는 작업을 수행한다.</li>\n<li>무효화를 Redis의 Pub/Sub 기능을 이용해 다른 서버에 전파를 수행한다. (분산 환경)</li>\n<li>캐시 매니저로는 Caffeine Cache를 사용한다.</li>\n</ul>\n<h3>로컬 캐시 적용하기</h3>\n<p>요구사항도 도출했으니 지금부터 하나씩 구현을 해보도록 하겠습니다. 먼저 가장 필요한 의존성부터 추가해주도록 하겠습니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/80b97b342c4777e3ad4ff6a1eea842d9/f97d7/img_1.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 23.52941176470588%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAqUlEQVQY042PXQ6DIBCEPU4FYWHBn1bFmt7/TFOXgol9aR++zGwgk5kmxAjvGZ4ZIQQQEZRW0Fr/pruqUgrNtr+wpCfmdQNHBg8evneHFg7vI2WyrwSCYwvrTPZdVwLH6YFhvKMfJhhrYL05P2cOT0Wrl3AJkoDv1o09QiRdlAPDkUN7a/9CteqKNFy3HfOSMKeEOEaEic95Mlnm1Xaf6WWu3HVJeSNn8QY9c5snOsqWFgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 1' title='img 1' src='/static/80b97b342c4777e3ad4ff6a1eea842d9/ca1dc/img_1.png' srcset='/static/80b97b342c4777e3ad4ff6a1eea842d9/e7570/img_1.png 170w,\n/static/80b97b342c4777e3ad4ff6a1eea842d9/f46e7/img_1.png 340w,\n/static/80b97b342c4777e3ad4ff6a1eea842d9/ca1dc/img_1.png 680w,\n/static/80b97b342c4777e3ad4ff6a1eea842d9/02d09/img_1.png 1020w,\n/static/80b97b342c4777e3ad4ff6a1eea842d9/9d567/img_1.png 1360w,\n/static/80b97b342c4777e3ad4ff6a1eea842d9/f97d7/img_1.png 2000w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>다음으로 캐시 설정 값들을 정의하는 Enum 클래스를 만들어주도록 하겠습니다. yml 파일을 이용해서 설정을 할 수도 있지만 각 메서드마다 적절하게 조절해서 값을 설정할 수 있기 때문에 Enum을 활용하여 각 Cache Type을 설정해주도록 하겠습니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/4a12bb7360a105921498181085295045/f97d7/img_2.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 48.8235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQklEQVQoz5VSW1LDMAz0cUjkt/xs2sJw/zstspMWCsxQPnYibyx5pZXaGsEZgg8BITKMMVjX9V8gonusghSIzoI5IaUMKzFpghaMi1rr+cgASXw76xnv3K3ogIo+gX1B9IwgKkdBF3ZYa8CiOiW5wyycwLl5jjHCc4Hz4bEg0SLEAho4SFoJy7L8wLg3kvdYWjy+Dy1fksZbNngvGtupY9tecS5XlFhFeYa3XhI+FfwFxZYwkN0qbQTEIO25jByqmOV/VTtVHgq/86olh0sP6NmjBJlPLhOjOJsXeO/BYtbgSm1IpSJ4JwJobkXKFaX1+X/MVxmjcZa2e5IEGXJv2zTIGjsTI/PxgKyUteKw3Z2em2Dmeed359VKGi0QGldReZmt1txx2q44X9/mOg0lQ+kzO6nmLt2Hqu/xjV+/OPyMKR95FDNyhJeJngAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 2' title='img 2' src='/static/4a12bb7360a105921498181085295045/ca1dc/img_2.png' srcset='/static/4a12bb7360a105921498181085295045/e7570/img_2.png 170w,\n/static/4a12bb7360a105921498181085295045/f46e7/img_2.png 340w,\n/static/4a12bb7360a105921498181085295045/ca1dc/img_2.png 680w,\n/static/4a12bb7360a105921498181085295045/02d09/img_2.png 1020w,\n/static/4a12bb7360a105921498181085295045/9d567/img_2.png 1360w,\n/static/4a12bb7360a105921498181085295045/f97d7/img_2.png 2000w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>이제 실제로 캐시를 적용하고자 하는 메서드에 캐시를 지정해주도록 하겠습니다. <code class=\"language-text\">@Cacheable</code> 애노테이션을 사용하면 캐시를 적용할 수 있습니다. 위에서 적용한 캐시 이름과 캐시 키를 명시적으로 작성해주도록 하겠습니다.</p>\n<blockquote>\n<p>Spring에서는 어떻게 캐시 기능을 제공하지?</p>\n</blockquote>\n<p>역시 믿고 쓰는 Spring 답게 등록한 빈의 메서드에 캐시를 적용할 수 있는 기능을 제공합니다. 위에서 보았듯이 다양한 캐시 서비스 구현기술을 사용할 수 있는데 <strong>스프링은 특정 기술에 종속되지 않게 캐시 추상화를 제공</strong>하고 있으며, <strong>AOP를 활용하여 보다 비즈니스 코드와 결합되지 않고 캐시를 사용할 수 있도록 기능을 제공</strong>하고 있습니다.</p>\n<br>\n<p>밑의 사진처럼 value 즉, <strong>캐시의 키를 명시해주지 않으면 메소드의 파라미터를 키로 설정</strong>하게 됩니다. 만약 <strong>파라미터가 없는 경우에는 0이라는 키를 저장</strong>합니다. 만약 <strong>파라미터 값이 여러개인 경우 모든 파라미터의 hashCode() 값을 조합해서 키로 생성</strong>하게 됩니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/99b7aa5c26f02d4bdb7574ffe45ca6ca/f97d7/img_3.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 59.411764705882355%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABwklEQVQoz41SW5LcIBDzcWZsMJiHsQG/Ziu5/40UNd5UbZLZqnzIDZgWanV3tSrkdcDGWItGzgalGFiroNWAYRjQ932L/4PuOBX2XWFZBsSoEecFYU4YtUI0A5RSbwm/e6TbZoXkFWbTY5ocyUgY5wYXIoy1LflvfEfajSzL6AHTOMCakaRTIxZYrsdxbBdFacOgbrKhf6u2U/wcQeGMCmXqUecJ58dPXMRxfSCXDSXt2NOFLZ0ocUecAp7P51u1nXwmeuUsFYpKa+B8YKQ6YwlDlYQeYUbutYGmv+oTX8kkdprlVnZZOr2sHkuuqPvJ5tBDp+klbfAa1hkEeuq8597CuPtMKf1vyTNHZE2JRBf240LeDu5XvErGwY6XkDhOLPt84Xz9wEobYpsEjcfj8UezusbOV+TysmaUSo/Sgtkt9OtApmdrqEhxxcbHfkOqqHy47rwjOZwKsaIRSvfSWuDDPS4+xuZXnBLCFBEsSzW+/UtLxswHRaFgyYXn99o5dzdF4PUDnk3xTJqXtcGF0JCoXFQLoSRKwzz9lCjjJWeG4yWd7xR90ALOo6ZSzR+tq4xa3/i6v6Nu9/RnrpxJlSLsF3N5eXmZx0zcAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 3' title='img 3' src='/static/99b7aa5c26f02d4bdb7574ffe45ca6ca/ca1dc/img_3.png' srcset='/static/99b7aa5c26f02d4bdb7574ffe45ca6ca/e7570/img_3.png 170w,\n/static/99b7aa5c26f02d4bdb7574ffe45ca6ca/f46e7/img_3.png 340w,\n/static/99b7aa5c26f02d4bdb7574ffe45ca6ca/ca1dc/img_3.png 680w,\n/static/99b7aa5c26f02d4bdb7574ffe45ca6ca/02d09/img_3.png 1020w,\n/static/99b7aa5c26f02d4bdb7574ffe45ca6ca/9d567/img_3.png 1360w,\n/static/99b7aa5c26f02d4bdb7574ffe45ca6ca/f97d7/img_3.png 2000w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>이렇게 캐시된 값이 변경되게 된다면 캐시를 제거해야 데이터 정합성을 유지할 수 있을 것입니다. <code class=\"language-text\">@CacheEvict</code> 애노테이션을 통해서 특정 메서드를 호출하면 키를 기준으로 저장되어 있는 캐시를 제거할 수 있습니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/235856855c07cedeaba735f2da594a3e/f97d7/img_4.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 37.64705882352941%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABRElEQVQoz12Ra27EIAyEc5wkEAPhHdhsW6lS73+hqU02q6o/RjYD/rBh6l2hNY1SE3wsUFrD7ARyl4w1CDFhIw3riWXgvIXWG9Z1hVLqHUXTybChTqjJIjIsBwO/cyEpGNoY6kBkYJ1jkMKyLG/AXwl4snqFYyUGtWxQo0FhoEA/g8KRA47HE62f+Pr+QX+c8CFAM2CeZ4YsfMH8vmRSSkNv3D7HddU88pVrHv2MhJIj2vnBT9KGjv5AY2ipB1Kp2H1AzAUxZZAxmGSjc8F9UDpp7UStHU/2T9bj+YXCxc7tcLsfElAIEfsrF23c2OTZFIkxRuEuveHDlj3ysNoxyCO9uhDJJ8nZOxflcsBKhwK7zMxmvQpZ4qVyxXstUTqy1o5xBZKGt2MZ78mfQkRjdpExdvzmWNO9/r9PYzTJDYNv7/7pX9AM/a8/qMixAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 4' title='img 4' src='/static/235856855c07cedeaba735f2da594a3e/ca1dc/img_4.png' srcset='/static/235856855c07cedeaba735f2da594a3e/e7570/img_4.png 170w,\n/static/235856855c07cedeaba735f2da594a3e/f46e7/img_4.png 340w,\n/static/235856855c07cedeaba735f2da594a3e/ca1dc/img_4.png 680w,\n/static/235856855c07cedeaba735f2da594a3e/02d09/img_4.png 1020w,\n/static/235856855c07cedeaba735f2da594a3e/9d567/img_4.png 1360w,\n/static/235856855c07cedeaba735f2da594a3e/f97d7/img_4.png 2000w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>지금까지 구현한 캐시가 잘 적용되는지 테스트 코드를 통해서 한번 확인해보겠습니다.</p>\n<p><strong>캐시 적용 전</strong></p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/fcdb56f35c7080aa6ddabfa34a9d7e31/f97d7/img_5.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 114.70588235294117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZUlEQVQ4y62UW3aDMAxE2Q6YN4R3wv5XpXLVTg/hK7j9GCyMPR5pZJJt22yaJuuG1UI1WKjHA8dY9RZCsCzLfPwUybIsNs+zDeNkeVFaFgoL+YGQxxFK4TwfhCI4kP3gLqkr7PvehmF4I4lR54TjONrj8bA8zx1Mpmn6pu6WQkhI+Tvt2clB27ZxCtlE2vu+2/P5tNfr5XHTNPGEqFvX1RUCDqjrOs4UUhaJAHm0wqIo3OWu69wUGRILd5mUIUUVKMvSTSEmdcVABzNPfF7DvoQAUi2oqso/qIWiXebGABkD+bUXP0qZDRDRLhAzUgJURpnCA0U4K5c5ILqxqRn3mBRRxeTV7TtxAhGm4DLkgFbCJL2fY1zlUA6/rmGftw1gkjQZtQGwSDHQ9/O8YjL7dZkaAv0oVMPbjc1pEOGuxj+7LIX/4jL54zL/QAquAlOPqJRxWT9WiNQ6uoIyQu+skWnXecR9AT4zwxqz/xr3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 5' title='img 5' src='/static/fcdb56f35c7080aa6ddabfa34a9d7e31/ca1dc/img_5.png' srcset='/static/fcdb56f35c7080aa6ddabfa34a9d7e31/e7570/img_5.png 170w,\n/static/fcdb56f35c7080aa6ddabfa34a9d7e31/f46e7/img_5.png 340w,\n/static/fcdb56f35c7080aa6ddabfa34a9d7e31/ca1dc/img_5.png 680w,\n/static/fcdb56f35c7080aa6ddabfa34a9d7e31/02d09/img_5.png 1020w,\n/static/fcdb56f35c7080aa6ddabfa34a9d7e31/9d567/img_5.png 1360w,\n/static/fcdb56f35c7080aa6ddabfa34a9d7e31/f97d7/img_5.png 2000w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/2a4c96d85ffb079c42b4d7d2a95653f1/f97d7/img_6.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 114.70588235294117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAABbklEQVQ4y6WUR3bEMAxDdR333sv9b8X4K8bE8cvCVhYYcVRgUCDltm2zcZysHVZLis6Ssv9G0VqSJBbHsR+fwk3TZKDvB0uz3OIkPRaEAMJ1XT3hPM+WpifBgfjEW1IHUdM01rbtSfKz+FadJxyGwbquO9SlHkxGUfRL3SuFbB7H0ae8LIvxAVDXdZhCfiDb990T4jpxWZZhhByCECIIAUYFE3JvpEjaAq4HE+Z5ftRg712GHENkSggcZCiEsKoqjyzLvCnEKFUMKDE+zDzxdQ/iHAFpsgBpURR+AdJ/mYIRGEIMrmXzKmUOQKayYUQxKoNdVmHjLvd5VxjsMvenFrw6/ST+pEwfowrHIAQYgkn6j4samUcJQjSvNc55QhQySZqMOsAGQHwF65rXHkBmDtmYQuuBu8uvC1uPgx5aRq4g2GV+9MpAphLiToMIyR2HIUAV96AukYvq73uf/zXvINPDqt6E+Ekvc5a1ay9/AV4hw3pl+yR6AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 6' title='img 6' src='/static/2a4c96d85ffb079c42b4d7d2a95653f1/ca1dc/img_6.png' srcset='/static/2a4c96d85ffb079c42b4d7d2a95653f1/e7570/img_6.png 170w,\n/static/2a4c96d85ffb079c42b4d7d2a95653f1/f46e7/img_6.png 340w,\n/static/2a4c96d85ffb079c42b4d7d2a95653f1/ca1dc/img_6.png 680w,\n/static/2a4c96d85ffb079c42b4d7d2a95653f1/02d09/img_6.png 1020w,\n/static/2a4c96d85ffb079c42b4d7d2a95653f1/9d567/img_6.png 1360w,\n/static/2a4c96d85ffb079c42b4d7d2a95653f1/f97d7/img_6.png 2000w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/e9d3fd800d804aa56412cbd68bbc8bc6/f97d7/img_7.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 16.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAs0lEQVQI122LXQvBUByH961k29k5XmabJduyRF5KlKKE+ATuuELK8vpJH4e4c/H0PP36/w3R2GGmG9zelvbszGD1pDO70ptfGa4fui/0F3e68xvNSUZ/+dA+05pmRKMTyehAfXgkHZ+oDfYYtp1HWBaWylH2iyRJTDUMiLWjOMLzPcKwSqz7vadpg4rnEgQ+rlvCkQKpHJSSSN2GkEVszcdOAVNILKH+4yhMW37ufojv748XacZ1oZge/dQAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 7' title='img 7' src='/static/e9d3fd800d804aa56412cbd68bbc8bc6/ca1dc/img_7.png' srcset='/static/e9d3fd800d804aa56412cbd68bbc8bc6/e7570/img_7.png 170w,\n/static/e9d3fd800d804aa56412cbd68bbc8bc6/f46e7/img_7.png 340w,\n/static/e9d3fd800d804aa56412cbd68bbc8bc6/ca1dc/img_7.png 680w,\n/static/e9d3fd800d804aa56412cbd68bbc8bc6/02d09/img_7.png 1020w,\n/static/e9d3fd800d804aa56412cbd68bbc8bc6/9d567/img_7.png 1360w,\n/static/e9d3fd800d804aa56412cbd68bbc8bc6/f97d7/img_7.png 2000w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<br>\n<p><strong>캐시 적용 후</strong></p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/587d4d077e08b1fb1ebeddab944ebcdb/f97d7/img_8.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 114.70588235294117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAABbUlEQVQ4y52U3bKCMAyEeR0p/wJFEXj/p8rh65x1quOF5mJN7NjNNptYPB4Pi8tiw7xaaCcLXTwxn/loIQQryzLFb1Hc73e73W4W42JV1VgZagvViVD5CNd1teVUCJ4EJ8p//EqaCMdxtHmeX0g86hJhjNGmaTqfWyVweLlcXtT9pBASSHkyvYQc9H3vU8gljDmOw7Zts33fU951nZ8QdfQShZCDtm19pvDknAhA7lZY13Vy+Xq9GrkM8aKQITICNE1jwzCkHKXKAYV5Fefk+W+4V5Awg/SMnIhSjZDLFHqGw+y1+kn191n86slcECFERNqASpcpfECEOrlMniv8iZCe0UM1lUP6l7utnPjpPM+TKdpnyGUKzun7e07RT+fcKxgZCGU9EYWo5QeAPAeE+bly7j13WRuiuYTcNdhUwwT+FCAkQkhFt8uaPUUKSKFrl3FZq0eDifTD9WTmDWWQipBKanK+gu/fdaapIP4BshTCq8l0gc8AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 8' title='img 8' src='/static/587d4d077e08b1fb1ebeddab944ebcdb/ca1dc/img_8.png' srcset='/static/587d4d077e08b1fb1ebeddab944ebcdb/e7570/img_8.png 170w,\n/static/587d4d077e08b1fb1ebeddab944ebcdb/f46e7/img_8.png 340w,\n/static/587d4d077e08b1fb1ebeddab944ebcdb/ca1dc/img_8.png 680w,\n/static/587d4d077e08b1fb1ebeddab944ebcdb/02d09/img_8.png 1020w,\n/static/587d4d077e08b1fb1ebeddab944ebcdb/9d567/img_8.png 1360w,\n/static/587d4d077e08b1fb1ebeddab944ebcdb/f97d7/img_8.png 2000w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/d0ee22f5ce3db46f5df85a4b4057a60e/f97d7/img_9.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 18.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA60lEQVQY01WKbU+CYBRA+Vc15fVhhhoICL6g1pZtKZFZrY2f0ec+6Uw3bRPqF55A3Vwfzu49517p8maJNdniJj/Y8R4nzmg9ZoVn+LMcp9iD5/zQ7dOt8bA/9Ob0iB3nhPPfouVIleiD+v0nw7cvxuk30cuGQcE43XGXbhm+bg69bL3Zmtv3HUGyKnyNN13QfVriTRZE8xWdZImkVCtUxQVmXWMQ9fG8FmHYptvrEARtLOuKfr+L77u4rsNoFNFoWtjONbWawDA0DKFhmgIhdCRZEyjqEVnVkTUDpWzFlNUzZZO1/67o4vR75g+tjqfIhlKtFAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 9' title='img 9' src='/static/d0ee22f5ce3db46f5df85a4b4057a60e/ca1dc/img_9.png' srcset='/static/d0ee22f5ce3db46f5df85a4b4057a60e/e7570/img_9.png 170w,\n/static/d0ee22f5ce3db46f5df85a4b4057a60e/f46e7/img_9.png 340w,\n/static/d0ee22f5ce3db46f5df85a4b4057a60e/ca1dc/img_9.png 680w,\n/static/d0ee22f5ce3db46f5df85a4b4057a60e/02d09/img_9.png 1020w,\n/static/d0ee22f5ce3db46f5df85a4b4057a60e/9d567/img_9.png 1360w,\n/static/d0ee22f5ce3db46f5df85a4b4057a60e/f97d7/img_9.png 2000w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>처음 메서드를 호출했을 때만 쿼리가 호출되고 이후로는 쿼리가 더 이상 호출되지 않는 것을 확인할 수 있습니다. 현재 테스트 상으로는 캐시로 인한 시간 절약이 거의 무의미한데, 실제 네트워크를 타게 된다면 훨씬 차이를 보일 것이라 예상하고 있습니다.</p>\n<h3>로컬 캐시 동기화 적용하기</h3>\n<p>이제 각 로컬 환경의 캐시들을 동기화 처리 해주기 위해서 레디스의 Pub/Sub를 이용한 동기화 작업을 해주도록 하겠습니다. 레디스를 사용하기 위한 <code class=\"language-text\">RedisTemplate</code>과 레디스에 발행된 데이터가 있는 확인할 수 있도록 <code class=\"language-text\">Listener</code>를 빈으로 등록해주도록 하겠습니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/cadd31cd7abbf0a2baf97e4ec6ea6005/f97d7/img_10.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 46.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABPUlEQVQoz21SWXbEIAzLccJOgKxkmWnvfybVJmSm6fRDT2CMZWGa4BSCk9BKQWsDRSyEgCQUlhKCUfe/wWecfzGjcVZiGRymZSVkjNOCaT45pR4xRqQYkPqB8hLF5zOXciKddyEWZviuQ8NKfUzY9wPr/kBed4zzUgoyD+OEaRzpQioXvH9Da/3RZaPIplYSRgkYayko0bYtWWpv9jh2QVz8j/Wm8wpDUlTMwboKKuycLx0YEjSG9txVd4LPbp0a8+5QS4GxJ8uPr9PydmDJa7HOb7Uwk+U157Lnp+hCIFES9r4I3QpyyzENOJ7fmPNGRZ+l8EqF89RjOx5FjIV4IK66cNbA6tPmzTIvgjPUZcRQJ+xJ2ZItZzRddMWio9hlt9inot7qz2/Dg5D1nxW1wqKyfMVeA7jW9X/+nfIP9/cYQexUHG0AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 10' title='img 10' src='/static/cadd31cd7abbf0a2baf97e4ec6ea6005/ca1dc/img_10.png' srcset='/static/cadd31cd7abbf0a2baf97e4ec6ea6005/e7570/img_10.png 170w,\n/static/cadd31cd7abbf0a2baf97e4ec6ea6005/f46e7/img_10.png 340w,\n/static/cadd31cd7abbf0a2baf97e4ec6ea6005/ca1dc/img_10.png 680w,\n/static/cadd31cd7abbf0a2baf97e4ec6ea6005/02d09/img_10.png 1020w,\n/static/cadd31cd7abbf0a2baf97e4ec6ea6005/9d567/img_10.png 1360w,\n/static/cadd31cd7abbf0a2baf97e4ec6ea6005/f97d7/img_10.png 2000w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>그리고 <strong>메시지를 발행하는 기능</strong>과 <strong>구독하는 기능</strong>을 각각 추가해주도록 하겠습니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/96a311309489c965358adb1248ae949d/f97d7/img_11.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 42.94117647058824%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABPklEQVQoz42SaVLEIBSEcxplD/uSzJT3P1XbEJ0atSz98dUDEpruB9vtUMhRw1gH6y6c22E5N8ZAKwX1C1rrR/1kS7tG9RqlFJTaUFtfdTKF1dPP/2EJRkeMQAgBMdeLVJBmjQm5VH6LCC4i+byw3Cyl/MJ0u013yRuM4siOo3kS0LJHcgopUZBucyE8YBLDdYj3gYeWNY4pw+07trwbnInUgjvj3nuncMLoDefRcbu/ofUBT/fe+yWyc+N07Njvtc7xrNZabEpbWqVlpSHkjGGuyrnSZvVFSoHX1xcIIRdzLoS4Yn6P3ING9hYjOroLuPWIkXfUknlBY7k7zjvGcUMJFpXEj5gz4o9b9s5SMKGlis7+NP7YGscU6hTp48SgYD9OZPYz+Os5zXia9YegZizJxYV85vkGxSPSX2/xHaX+FuBFbVB8AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 11' title='img 11' src='/static/96a311309489c965358adb1248ae949d/ca1dc/img_11.png' srcset='/static/96a311309489c965358adb1248ae949d/e7570/img_11.png 170w,\n/static/96a311309489c965358adb1248ae949d/f46e7/img_11.png 340w,\n/static/96a311309489c965358adb1248ae949d/ca1dc/img_11.png 680w,\n/static/96a311309489c965358adb1248ae949d/02d09/img_11.png 1020w,\n/static/96a311309489c965358adb1248ae949d/9d567/img_11.png 1360w,\n/static/96a311309489c965358adb1248ae949d/f97d7/img_11.png 2000w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/54423e51679a800514fa46133e62bec4/f97d7/img_12.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 53.529411764705884%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABkUlEQVQoz3VSa3rjIAz0ccwbBPhFHG/a+59pKuTEbbO7P+YTyGY0I2los0bwFtY6OHvG6DTIKcQYkCgjpsR5C601jDEX3u8dQw0GNRqUTJjmFaVOqKVgKhmZY6aKmid454Tghf+RDksymJiwEyzbDXWaUWjiAjMck1hjLxhxYC+1L7Kf5yE5Zu4PXf/RMInFEkdsrWE/PjjuaPuBdWsgtl/nRVz0YqYX0W+WndXIwYNiRfQk/bq3Bbf9Lo9zqSisuscQIihn6WuPzvtfbegYAiuce/8K94/71R8urIqIuPqzP1oJutWX7W/77hyoKGaF1nmkXBi9MiElkuokKjjPiilYJN4EyXPuQuQ3geTfzG3wrHiwtktVGEeGUlCCEWp8Qukn1POuoF/Q6tuuOs/DNvGEs2XLga0HkHeXOlHE6ojVdeUp5cuaDORtB88ph4C2NMaKtq7nud0Ft3ZwbsPGEz4eBx6ffzDz9+224/FxCPlfe9grOet5z/rqeJmc4yjN7t/ceQ+8CSkFOfu+FRT/udhfNmlVX4q6/ZwAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 12' title='img 12' src='/static/54423e51679a800514fa46133e62bec4/ca1dc/img_12.png' srcset='/static/54423e51679a800514fa46133e62bec4/e7570/img_12.png 170w,\n/static/54423e51679a800514fa46133e62bec4/f46e7/img_12.png 340w,\n/static/54423e51679a800514fa46133e62bec4/ca1dc/img_12.png 680w,\n/static/54423e51679a800514fa46133e62bec4/02d09/img_12.png 1020w,\n/static/54423e51679a800514fa46133e62bec4/9d567/img_12.png 1360w,\n/static/54423e51679a800514fa46133e62bec4/f97d7/img_12.png 2000w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>다른 애플리케이션에서 메시지를 발행하였을 때, 메시지를 구독하는 기능인 Subscriber 입니다. 생성하는 시점에서 <code class=\"language-text\">redisMessageListener</code>를 주입받은 후, <code class=\"language-text\">addMessageListener()</code>를 통해 <strong>자기자신을 메시지 리스너로 등록하고 설정한 채널 토픽(캐시 이름)을 등록하도록 기능을 구현</strong>합니다.</p>\n<p>그리고 캐시 무효화가 필요한 비즈니스 로직에 이전에 구현한 Publisher를 주입받은 후, 해당하는 캐시의 채널 토픽과 키를 가지고 메시지를 발행하는 로직을 구현합니다. 이 메시지를 위에서 언급한 Subscriber가 받아 캐시를 <code class=\"language-text\">evict</code> 처리를 수행합니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/d96944a180f2497321d5ebb56415bfe9/f97d7/img_13.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 40.588235294117645%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQUlEQVQoz12SWXKDMBBEfRsH7QsSWrCJK/c/U2dmME5VPlotgeb1SHDrm8LsCqMp9M0geovgDAK5swbWaFhrYUjWOmitoZZF/L+UUri1qFGjQgkErg7HiOQecwvYi8NICm3s2FrH8fpB6wPeB4EuH30JjKG3RRFZG2hjxa/5l+IgiyeDjxfGfKDPHfNxYH8eErCWipQy6tYRUzqBPNStYexnQRsTnTpqbWCSPwkwH9/0bEoxF0bylFfktcia5zESkI/MrV4vJTFnusOANVbkQAWeIDGj1I3UxHkf61pzQxymtTo7lJT1Da1VdK1zKZ9AVggBznsC/oENMe73+/lRBBgSciRYKuI5rJLIRWcX7QxL9eyc99K7ja4lxIhMgQx2zuHGgzUO3gaSf3uQL8mbPwoRnq7iEj/jk3G9zOkO+ff6BSAs/PX3F0EgAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 13' title='img 13' src='/static/d96944a180f2497321d5ebb56415bfe9/ca1dc/img_13.png' srcset='/static/d96944a180f2497321d5ebb56415bfe9/e7570/img_13.png 170w,\n/static/d96944a180f2497321d5ebb56415bfe9/f46e7/img_13.png 340w,\n/static/d96944a180f2497321d5ebb56415bfe9/ca1dc/img_13.png 680w,\n/static/d96944a180f2497321d5ebb56415bfe9/02d09/img_13.png 1020w,\n/static/d96944a180f2497321d5ebb56415bfe9/9d567/img_13.png 1360w,\n/static/d96944a180f2497321d5ebb56415bfe9/f97d7/img_13.png 2000w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>해당 과정을 통해 테스트를 수행하보면 정상적으로 각 서버의 로컬 캐시가 <code class=\"language-text\">evict</code> 처리가 이루어지는 것을 확인할 수 있습니다.</p>\n<p><strong>WAS 1 에서 캐시 변경 작업</strong></p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/37eecdc582118f9b899426e409a9c066/f97d7/img_14.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 97.05882352941177%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAABM0lEQVQ4y6WU6Y6DMAyEeRzu+74RvP8refUhOaLVdjfQH9O4gUzG9hjH8zzJ81yqqpI0TSVJkvN/GIbCM9/3DYIgMOsnOLwQRZFs2ybDMMg8zyf6vpe2bWUcR6nr2orMEMZxLPu+yzRNchyHIdU4y7J7hChECYpQ1jSNdF137pVl+UJmnTKHlYiVNIkBtbVR92vKy7IYUFcuKoribJJVyvyQFoo4SEynAbVDva26kxBrQMRhJXFd14DnV0D+vneFAwGqsAz1wo/s4UUuQCExUJ+y6jvXmNWhRtQKUn2oeESITMgA8TVNnZBbKdM9btEbiG0b8NE2pIFtdPxsp+JPH67renru6rcnpGZSGDs6DPlTdS+EKORDgMG/ItRJoXbMsDblcQ2VkA7f/Zj+W0OAfb5J+QfgiEjXlxa3/wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 14' title='img 14' src='/static/37eecdc582118f9b899426e409a9c066/ca1dc/img_14.png' srcset='/static/37eecdc582118f9b899426e409a9c066/e7570/img_14.png 170w,\n/static/37eecdc582118f9b899426e409a9c066/f46e7/img_14.png 340w,\n/static/37eecdc582118f9b899426e409a9c066/ca1dc/img_14.png 680w,\n/static/37eecdc582118f9b899426e409a9c066/02d09/img_14.png 1020w,\n/static/37eecdc582118f9b899426e409a9c066/9d567/img_14.png 1360w,\n/static/37eecdc582118f9b899426e409a9c066/f97d7/img_14.png 2000w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<br>\n<p><strong>WAS 2 에서 캐시가 evict 처리되어 데이터베이스 조회</strong></p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/0abd50fa7bb2f4b078e11efcf61a3048/f97d7/img_15.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 140%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB8klEQVRIx5WV6Q6CMBCE+zieoIioeKAE4vs/Uc23yZBCBMqPsdvaTveYLe58Pvvn8+nTNPXr9dpvNpu/2G63PXsMDhLIrterP51OPssyzyWMbNjtdoaQaIrU8ed+v/d1XfvX6+Xf77cBrwH24/GwS+e86xF+Ph87qBHoEjyPIesICaksS3+5XAxFURhut5vNh97NhgwhnkCKZxAB7Pv9bqTDPE4S4gG54jAkyl9VVTbP89wnSRJHyA8HVGFGVRbEyqUnGxEdDgcDawJEU/MhnApAaOQQG4/R4vF4tFCxpU3WuFx7WMPWOUfCyZ9CRUKQAIWsNUbtCddC261WK5tQEHnCJVwQbhxrySE6YVNRpEJ1FT6XSE6LOoXNbdva4bBjuITcxJJ1hIQFAZ7gIZ6GNuGHHRLVKXhF7nh11IbYrDNGC5tNeIAnFITDEjrhIgtyHBNuRwiJKguovDAUtTAmdEdnIFbChFhiBfyHd5pTHKCO4pzmEr0jVOTBogStgxI3G4H2iExrjHLAHgc8g1R/kEPsMDcxIZuwMfCiaRqrqD4BerXR4mJhk6dQKlSXURUnlEUPrIQdtppaEMLQu7m3sSP8fr9d6+mrx0cKcNGikCmAdKgXR8LW8z/Xcr1PgJ5/VXlMzFEh84NH5AuP9BD8Q4yHP0T+ZzlNRH9hAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 15' title='img 15' src='/static/0abd50fa7bb2f4b078e11efcf61a3048/ca1dc/img_15.png' srcset='/static/0abd50fa7bb2f4b078e11efcf61a3048/e7570/img_15.png 170w,\n/static/0abd50fa7bb2f4b078e11efcf61a3048/f46e7/img_15.png 340w,\n/static/0abd50fa7bb2f4b078e11efcf61a3048/ca1dc/img_15.png 680w,\n/static/0abd50fa7bb2f4b078e11efcf61a3048/02d09/img_15.png 1020w,\n/static/0abd50fa7bb2f4b078e11efcf61a3048/9d567/img_15.png 1360w,\n/static/0abd50fa7bb2f4b078e11efcf61a3048/f97d7/img_15.png 2000w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<h2>마무리</h2>\n<p>해당 과정들을 통해 실제 로컬 캐시를 적용해보고, 분산 환경에서 로컬 캐시를 동기화하는 과정을 구현해보았습니다. <strong>하지만 최종적으로는 로컬 캐시의 Pub/Sub 기능을 사용하지 않기로 하였습니다.</strong> 결국 캐시 갱신으로 인한 네트워크 비용이 발생하기 때문에 글로벌 캐시와 매우 유의미한 차이를 보이지 않은 것이라 생각했기 때문입니다. 오히려 상태 변경이라는 정합성이 조금 더 중요하기 때문에 레디스를 활용한 글로벌 캐시를 사용하는 것이 더 적절하다는 생각이 들어 해당 기능은 Deprecated 하였습니다.</p>\n<p>추가적으로 레디스에 대해서 조금 더 공부를 해봐야겠다는 생각이 들었습니다. 기본적으로 어떠한 기능이 있다는 것을 알기만 상태에서 적용을 해보았는데 근본적으로 레디스는 어떠한 구조에서 동작하는지 등을 학습하여 조금 더 적절하게 사용할 수 있는 방법을 고민해봐야 할 것 같습니다.</p>\n<h2>참고</h2>\n<ul>\n<li><a href=\"https://pompitzz.github.io/blog/Redis/LocalCacheSyncWithRedisPubSub.html#redis-pub-sub\">https://pompitzz.github.io/blog/Redis/LocalCacheSyncWithRedisPubSub.html#redis-pub-sub</a></li>\n<li><a href=\"https://docs.spring.io/spring-framework/docs/5.3.23/reference/html/integration.html#cache\">https://docs.spring.io/spring-framework/docs/5.3.23/reference/html/integration.html#cache</a></li>\n<li><a href=\"https://velog.io/@injoon2019/Caffeine-Cache-%EB%A1%9C%EC%BB%AC-%EC%BA%90%EC%8B%9C-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0\">https://velog.io/@injoon2019/Caffeine-Cache-로컬-캐시-적용하기</a></li>\n<li><a href=\"https://brunch.co.kr/@springboot/151\">https://brunch.co.kr/@springboot/151</a></li>\n<li><a href=\"https://gngsn.tistory.com/157\">https://gngsn.tistory.com/157</a></li>\n<li><a href=\"https://medium.com/frientrip/pub-sub-%EC%9E%98-%EC%95%8C%EA%B3%A0-%EC%93%B0%EC%9E%90-de9dc1b9f739\">https://medium.com/frientrip/pub-sub-잘-알고-쓰자-de9dc1b9f739</a></li>\n</ul>","frontmatter":{"title":"로컬 캐시와 글로벌 캐시에 대해서 고민해보기","date":"December 09, 2022","update":"December 09, 2022","tags":["Cache"],"series":null},"fields":{"slug":"/로컬 캐시와 글로벌 캐시에 대해서 고민해보기/","readingTime":{"minutes":19.665}}},"seriesList":{"edges":[{"node":{"id":"863212f2-1cb1-5101-804a-5416ffb5b9d3","fields":{"slug":"/Nginx와-Gzip을-활용한-프론트-최적화/"},"frontmatter":{"title":"Nginx와 Gzip을 활용한 프론트 최적화"}}},{"node":{"id":"4c21b76a-ad6b-5e0b-b0e7-a0c0e94b12a9","fields":{"slug":"/Replication과-SpringBoot/"},"frontmatter":{"title":"Replication과 Spring Boot"}}},{"node":{"id":"aae5e42a-02b5-56c8-8475-67f77087a495","fields":{"slug":"/JPA를-사용함으로서-겪었던-문제들/"},"frontmatter":{"title":"JPA를 사용함으로서 겪었던 문제들"}}},{"node":{"id":"948cec5b-7366-505a-992f-1dd680a012ee","fields":{"slug":"/테스트에서의 @Transactional/"},"frontmatter":{"title":"테스트에서의 @Transactional"}}},{"node":{"id":"c4eb0572-f278-5d08-9052-32b5b549b9bb","fields":{"slug":"/DAO와-Repository/"},"frontmatter":{"title":"DAO와 Repository"}}},{"node":{"id":"9adaf203-e9ac-55e1-a772-b716b41c886a","fields":{"slug":"/캐시 설계 전략에 대해서 고민해보기/"},"frontmatter":{"title":"캐시 설계 전략에 대해서 고민해보기"}}},{"node":{"id":"402909e7-5260-5a3b-9183-5ac1017382fe","fields":{"slug":"/로컬 캐시와 글로벌 캐시에 대해서 고민해보기/"},"frontmatter":{"title":"로컬 캐시와 글로벌 캐시에 대해서 고민해보기"}}},{"node":{"id":"c20ecd3e-8f83-53ad-89dd-dc937758fc6e","fields":{"slug":"/현재 시간을 검증해야 하는 로직 개선에 대해 고민해보기/"},"frontmatter":{"title":"현재 시간을 검증해야 하는 로직 개선에 대해 고민해보기"}}},{"node":{"id":"5d3cba24-3007-5309-a0f7-2430e555a818","fields":{"slug":"/JpaTransactionManager는 JDBC도 처리해준다/"},"frontmatter":{"title":"JpaTransactionManager는 JDBC도 처리해준다"}}},{"node":{"id":"d99299ea-4097-5011-8747-1a2ed6f40e8d","fields":{"slug":"/물리적 관점에서 인덱스 살펴보기/"},"frontmatter":{"title":"물리적 관점에서 인덱스 살펴보기"}}}]},"previous":{"fields":{"slug":"/캐시 설계 전략에 대해서 고민해보기/"},"frontmatter":{"title":"캐시 설계 전략에 대해서 고민해보기"}},"next":{"fields":{"slug":"/현재 시간을 검증해야 하는 로직 개선에 대해 고민해보기/"},"frontmatter":{"title":"현재 시간을 검증해야 하는 로직 개선에 대해 고민해보기"}}},"pageContext":{"id":"402909e7-5260-5a3b-9183-5ac1017382fe","series":null,"previousPostId":"9adaf203-e9ac-55e1-a772-b716b41c886a","nextPostId":"c20ecd3e-8f83-53ad-89dd-dc937758fc6e"}},"staticQueryHashes":[]}